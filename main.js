(()=>{"use strict";var e=function(e,o,c){var a=e.querySelector(c.buttonSelector);t(o)?n(a,c):r(a,c)},t=function(e){return e.some((function(e){return!e.validity.valid}))},n=function(e,t){e.classList.add(t.buttonDisabledClass),e.disabled=!0},r=function(e,t){e.classList.remove(t.buttonDisabledClass),e.disabled=!1},o={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"bc5524e6-2f6e-4891-adc9-e477685018b2","Content-Type":"application/json"}},c=function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then(i)},a=function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then(i)},i=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},l=document.querySelector("#popup_edit-profile"),u=document.querySelector("#popup_pic"),s=document.querySelector("#popup_change-avatar"),d=document.querySelector(".profile__edit-btn"),f=document.querySelector(".pic-container__image"),m=document.querySelector(".pic-container__caption"),p=document.querySelector(".profile__name"),v=document.querySelector(".profile__description"),y=document.querySelector(".form-name"),h=document.querySelector(".form-avatar"),_=l.querySelector('input[name="name"]'),b=l.querySelector('input[name="description"]'),S=s.querySelector('input[name="link"]'),q=document.querySelector(".profile__picture"),g=l.querySelector(".form__save-btn"),C=s.querySelector(".form__save-btn"),L=function(e){f.src=e.target.src,f.alt=e.target.alt,m.textContent=e.target.alt,E(u)},E=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x)},k=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)};function x(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&k(t)}}d.addEventListener("click",(function(){_.value=p.textContent,b.value=v.textContent,E(l)})),y.addEventListener("submit",(function(e){var t,n;e.preventDefault(),g.textContent="Сохранение...",(t=_.value,n=b.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then(i)).then((function(e){p.textContent=e.name,v.textContent=e.about,k(l)})).catch((function(e){alert("Ошибка"),console.log(e)})).finally((function(){g.textContent="Сохранить"}))})),h.addEventListener("submit",(function(e){var t;e.preventDefault(),C.textContent="Сохранение...",(t=S.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(i)).then((function(){q.style="background-image: url(".concat(S.value,")"),k(s)})).catch((function(e){alert("Ошибка"),console.log(e)})).finally((function(){C.textContent="Сохранить"}))}));var A=document.querySelector("#card-template").content,U=document.querySelector("#popup_add-card"),D=document.querySelector(".profile__add-card-btn"),T=document.querySelector(".location-cards"),w=U.querySelector('input[name="name"]'),I=U.querySelector('input[name="link"]'),j=U.querySelector(".form__save-btn"),O=document.querySelector(".form-card"),P="location-card__like-btn_active",N=".location-card",J=".location-card__image",H=".location-card__name",M=".location-card__like-btn",z=".location-card__delete-btn",B=".location-card__like-number",$=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=A.querySelector(N).cloneNode(!0),u=l.querySelector(J),s=l.querySelector(H);l.setAttribute("id",n),u.src=t,u.alt=e,s.textContent=e;var d=l.querySelector(B);d.textContent=o;var f=l.querySelector(M);r&&f.classList.add(P),f.addEventListener("click",(function(){f.classList.contains(P)?a(n).then((function(e){F(e._id,e.likes.length),f.classList.toggle(P)})).catch((function(e){alert("Ошибка"),console.log(e)})):c(n).then((function(e){F(e._id,e.likes.length),f.classList.toggle(P)})).catch((function(e){alert("Ошибка"),console.log(e)}))}));var m=l.querySelector(z);return i?m.addEventListener("click",G):m.style.display="none",u.addEventListener("click",L),l},F=function(e,t){document.getElementById(e).querySelector(B).textContent=t},G=function(e){var t,n=e.srcElement.closest(".location-card");(t=n.id,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then(i)).then((function(e){e&&n.remove()})).catch((function(e){alert("Ошибка"),console.log(e)}))};function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}O.addEventListener("submit",(function(e){var t,r;e.preventDefault(),j.textContent="Создание...",(t=w.value,r=I.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:r})}).then(i)).then((function(t){T.prepend($(t.name,t.link,t._id)),w.value="",I.value="",k(U),n(e.submitter,{buttonDisabledClass:"form__save-btn_disabled"})})).catch((function(e){alert("Ошибка"),console.log(e)})).finally((function(){j.textContent="Создать"}))})),D.addEventListener("click",(function(){return E(U)}));var Q=document.querySelector(".location-cards"),R=document.querySelector(".profile__name"),V=document.querySelector(".profile__description"),W=document.querySelector(".profile__picture"),X=document.querySelectorAll(".popup"),Y=document.querySelector(".profile__picture");!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector));r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(n.inputInvalidClass),t.classList.remove(n.errorClass),t.textContent=""}(t,r,n):function(e,t,n,r){e.classList.add(r.inputInvalidClass),t.classList.add(r.errorClass),t.textContent=n}(t,r,t.validationMessage,n)}(t,o,n),e(t,r,n)}))})),e(t,r,n)}(n,t)}))}({formSelector:".form",inputSelector:".form__input",errorClass:"error-message_visible",inputInvalidClass:"form__input_invalid",buttonSelector:".form__save-btn",buttonDisabledClass:"form__save-btn_disabled"}),Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(i),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(i)]).then((function(e){var t,n,r,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];r=c,R.textContent=r.name,V.textContent=r.about,W.style="background-image: url(".concat(r.avatar,")");var i=c._id;a.forEach((function(e){return Q.prepend($(e.name,e.link,e._id,e.likes.some((function(e){return e._id===i})),e.likes.length,e.owner._id===i))}))})).catch((function(e){alert("Ошибка"),console.log(e)})),X.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-btn"))&&k(e)}))})),Y.addEventListener("click",(function(){E(s)}))})();