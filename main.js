(()=>{"use strict";var e=function(e,o,c){var a=e.querySelector(c.buttonSelector);t(o)?n(a,c):r(a,c)},t=function(e){return e.some((function(e){return!e.validity.valid}))},n=function(e,t){e.classList.add(t.buttonDisabledClass),e.disabled=!0},r=function(e,t){e.classList.remove(t.buttonDisabledClass),e.disabled=!1},o={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"bc5524e6-2f6e-4891-adc9-e477685018b2","Content-Type":"application/json"}},c=function(){return fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))},a=function(e){alert("".concat(e.status," ").concat(e.statusText))},i=document.querySelector("#popup_edit-profile"),u=document.querySelector("#popup_pic"),l=document.querySelector("#popup_change-avatar"),s=document.querySelector(".profile__edit-btn"),d=document.querySelector(".pic-container__image"),f=document.querySelector(".pic-container__caption"),m=document.querySelector(".profile__name"),p=document.querySelector(".profile__description"),v=document.querySelector(".form-name"),h=document.querySelector(".form-avatar"),_=i.querySelector('input[name="name"]'),y=i.querySelector('input[name="description"]'),b=l.querySelector('input[name="link"]'),S=document.querySelector(".profile__picture"),q=i.querySelector(".form__save-btn"),k=l.querySelector(".form__save-btn"),E=function(e){d.src=e.target.src,d.alt=e.target.alt,f.textContent=e.target.alt,g(u)},g=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",L)},C=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",L)};function L(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&C(t)}}s.addEventListener("click",(function(){_.value=m.textContent,y.value=p.textContent,g(i)})),v.addEventListener("submit",(function(e){var t,n;e.preventDefault(),q.textContent="Сохранение...",(t=_.value,n=y.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))).then((function(e){m.textContent=e.name,p.textContent=e.about})).finally((function(){q.textContent="Сохранить"})),C(i)})),h.addEventListener("submit",(function(e){var t;e.preventDefault(),k.textContent="Сохранение...",(t=b.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))).then(S.style="background-image: url(".concat(b.value,")")).finally((function(){k.textContent="Сохранить"})),C(l)}));var x=function(){g(l)},N=document.querySelector("#card-template").content,A=document.querySelector("#popup_add-card"),D=document.querySelector(".profile__add-card-btn"),U=document.querySelector(".location-cards"),j=A.querySelector('input[name="name"]'),T=A.querySelector('input[name="link"]'),P=A.querySelector(".form__save-btn"),I=document.querySelector(".form-card"),O="location-card__like-btn_active",w=".location-card",J=".location-card__image",H=".location-card__name",z=".location-card__like-btn",B=".location-card__delete-btn",M=".location-card__like-number",F=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=N.querySelector(w).cloneNode(!0),i=a.querySelector(J),u=a.querySelector(H);a.setAttribute("id",n),i.src=t,i.alt=e,u.textContent=e;var l=a.querySelector(M);l.textContent=o;var s=a.querySelector(z);r&&s.classList.add(O),s.addEventListener("click",G);var d=a.querySelector(B);return c?d.addEventListener("click",Q):d.style.display="none",i.addEventListener("click",E),a},G=function(e){var t;e.srcElement.classList.contains(O)?(t=e.srcElement.parentNode.parentNode.parentNode.getAttribute("id"),fetch("".concat(o.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:o.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))).then((function(t){K(t._id,t.likes.length),e.srcElement.classList.toggle(O)})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))}(e.srcElement.parentNode.parentNode.parentNode.getAttribute("id")).then((function(t){K(t._id,t.likes.length),e.srcElement.classList.toggle(O)}))},K=function(e,t){document.getElementById(e).querySelector(M).textContent=t},Q=function(e){var t;(t=e.srcElement.parentNode.getAttribute("id"),fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok})).catch((function(e){return a(e)}))).then((function(t){t&&e.srcElement.parentNode.remove()}))};I.addEventListener("submit",(function(e){var t,r;e.preventDefault(),P.textContent="Создание...",(t=j.value,r=T.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:r})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))).then((function(e){U.prepend(F(e.name,e.link,e._id))})).finally((function(){P.textContent="Создать",j.value="",T.value="",C(A),n(e.submitter,{buttonDisabledClass:"form__save-btn_disabled"})}))})),D.addEventListener("click",(function(){return g(A)}));var R,V=document.querySelectorAll(".popup"),W=document.querySelector(".profile__name"),X=document.querySelector(".profile__description"),Y=document.querySelector(".profile__picture");!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector));r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(n.inputInvalidClass),t.classList.remove(n.errorClass),t.textContent=""}(t,r,n):function(e,t,n,r){e.classList.add(r.inputInvalidClass),t.classList.add(r.errorClass),t.textContent=n}(t,r,t.validationMessage,n)}(t,o,n),e(t,r,n)}))})),e(t,r,n)}(n,t)}))}({formSelector:".form",inputSelector:".form__input",errorClass:"error-message_visible",inputInvalidClass:"form__input_invalid",buttonSelector:".form__save-btn",buttonDisabledClass:"form__save-btn_disabled"}),R=[c(),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return a(e)}))],Promise.all(R).then((function(e){var t=e[0]._id;e[1].forEach((function(e){return U.prepend(F(e.name,e.link,e._id,e.likes.some((function(e){return e._id===t})),e.likes.length,e.owner._id===t))}))})),c().then((function(e){return Z(e)})),V.forEach((function(e){e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-btn"))&&C(e)}))}));var Z=function(e){W.textContent=e.name,X.textContent=e.about,Y.style="background-image: url(".concat(e.avatar,")"),Y.addEventListener("click",x)}})();